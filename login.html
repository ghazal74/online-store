<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>login</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    
    <!-- CSS 
    ========================= -->


    <!-- Plugins CSS -->
    <link rel="stylesheet" href="plugins.css">
    
    <!-- Main Style CSS -->
    <link rel="stylesheet" href="style.css">

</head>

<body>

    <!-- hash section -->
    <div class="hash">
        <div class="container5">Free Returns: For First 40 Days</div>
        <li class="top_links"><a href="#">Sign In <i class="ion-chevron-down"></i></a>
            <ul class="dropdown_links">
                <li><a href="#">Sign In</a></li>
            </ul>
        </li>
        <li class="language"><a href="#"><img src="img/language.png" alt=""> English <i class="ion-chevron-down"></i></a>
            <ul class="dropdown_language">
                <li><a href="#"><img src="img/language2.png" alt="">Arabic</a></li>
            </ul>
        </li>
        <div class="currency">
            <a href="#">USD <i class="ion-chevron-down"></i></a>
            <ul class="dropdown_currency">
                <li><a href="#">SAR</a></li>
                <li><a href="#">AED</a></li>
                <li><a href="#">UED</a></li>
            </ul>
        </div>
    
    </div>
                     
    
    <!-- customer login start -->
    <div class="customer_login">
        <div class="container">
            <div class="row">
                <!-- Login Area -->
                <div class="col-lg-6 col-md-6">
                    <div class="account_form">
                        <h2>Login</h2>
                        <form action="#">
                            <p>
                                <label for="username">Username or email <span>*</span></label>
                                <input type="email" id="username" name="username" required>
                            </p>
                            <p>
                                <label for="password">Password <span>*</span></label>
                                <input type="password" id="password" name="password" required>
                            </p>
                            <div class="login_submit">
                                <a href="#">Lost your password?</a>
                                <label for="remember">
                                    <input id="remember" type="checkbox">
                                    Remember me
                                </label>
                                <button type="submit">Login</button>
                            </div>
                        </form>
                    </div>
                </div>
    
                <!-- Register Area -->
                <div class="col-lg-6 col-md-6">
                    <div class="account_form register">
                        <h2>Register</h2>
                        <form action="#">
                            <p>
                                <label for="email">Email address <span>*</span></label>
                                <input type="email" id="email" name="email" required>
                            </p>
                            <p>
                                <label for="reg_password">Password <span>*</span></label>
                                <input type="password" id="reg_password" name="reg_password" required>
                            </p>
                            <div class="login_submit">
                                <button type="submit">Register</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- customer login end -->

    <!-- customer login end -->

            <!--footer content-->
            <footer class="footer">
                <div class="container7">
                    <div class="column">
                        <h3>Contact Information</h3>
                        <p>📞 Phone: 0528686321</p>
                        <p>✉️ Email: Info@almotabaed.com</p>
                    </div>
                    <div class="column">
                        <h3>Important Links</h3>
                        <a href="#">Privacy Policy</a>
                        <br>
                        <a href="#">Terms of Use</a>
                    </div>
                    <div class="column social">
                        <h3>Follow Us</h3>
                        <a href="#"> Facebook</a>
                        <br>
                        <a href="#"> Twitter</a>
                        <br>
                        <a href="#"> Instagram</a>
                    </div>
                </div>
                <div class="copyright">
                    &copy; 2025 All Rights Reserved | KGM Marketing
                </div>
            </footer>

    <!--footer area end-->

<!-- JS
============================================ 
<script>
    document.addEventListener("DOMContentLoaded", function () {
    // استهداف نماذج تسجيل الدخول والتسجيل
    const loginForm = document.querySelector('.account_form form[action="#"]');
    const registerForm = document.querySelector('.account_form.register form[action="#"]');

    // التعامل مع نموذج تسجيل الدخول
    if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            console.log("🔍 Sending login data:", { email, password });

            try {
                const res = await fetch('http://localhost:5000/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();
                console.log("🛠 Server Response:", data);

                if (!res.ok) {
                    throw new Error(data.message || "Login failed");
                }

                localStorage.setItem('token', data.token);
                window.location.href = "index.html";
            } catch (error) {
                alert("❌ Login failed. Check your credentials.");
                console.error("🚨 Error:", error);
            }
        });
    }

    // التعامل مع نموذج التسجيل
    if (registerForm) {
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('reg_password').value.trim();

            if (!email || !password) {
                alert("❌ Please enter a valid email and password.");
                return;
            }

            try {
                const res = await fetch('http://localhost:5000/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (!res.ok) {
                    throw new Error("Registration failed");
                }

                const data = await res.json();
                localStorage.setItem('token', data.token);
                window.location.href = "index.html";
            } catch (error) {
                alert("❌ Registration failed. Try again.");
                console.error("🚨 Error:", error);
            }
        });
    }
});



        if (document.querySelector("#remember").checked) {
                localStorage.setItem('token', data.token);
            } else {
                sessionStorage.setItem('token', data.token);
            }

            if (localStorage.getItem('token') || sessionStorage.getItem('token')) {
                    window.location.href = "index.html";
                }

    document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("token") || sessionStorage.getItem("token");

        // إذا لم يكن المستخدم مسجلًا، قم بتحويله إلى login.html
        if (!token && window.location.pathname !== "/login.html") {
            window.location.href = "login.html";
        }
    });
    document.getElementById("logout").addEventListener("click", function () {
        localStorage.removeItem("token");  // حذف التوكن من التخزين
        sessionStorage.removeItem("token");
        window.location.href = "login.html";  // تحويل المستخدم لصفحة تسجيل الدخول
    });

 </script>
 -->
<script>
   document.addEventListener("DOMContentLoaded", function () {
        const API_URL = "https://online-store-production-d74f.up.railway.app";

        // ✅ جلب عناصر الصفحة
        const loginForm = document.querySelector('.account_form form');
        const registerForm = document.querySelector('.account_form.register form');
        const rememberMeCheckbox = document.getElementById('remember');
        const loader = document.createElement("div"); // 🔹 Loader للتحميل

        loader.innerHTML = "🔄 Loading..."; // نص التحميل
        loader.style.display = "none"; // إخفاءه افتراضيًا
        document.body.appendChild(loader);

        // ✅ دالة تسجيل الدخول
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const email = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                const rememberMe = rememberMeCheckbox.checked;

                if (!email || !password) {
                    showAlert("❌ Please enter both email and password.", "error");
                    return;
                }

                loader.style.display = "block"; // 🔄 إظهار التحميل

                try {
                    const res = await fetch(`${API_URL}/login`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ email, password })
                    });

                    if (!res.ok) {
                        const data = await res.json();
                        throw new Error(data.message || "❌ Login failed");
                    }

                    const data = await res.json();
                    saveUserSession(data.token, rememberMe);
                    showAlert("✅ Login successful!", "success");
                    setTimeout(() => window.location.href = "index.html", 1000);
                } catch (error) {
                    showAlert(error.message, "error");
                    console.error("🚨 Login error:", error);
                } finally {
                    loader.style.display = "none"; // 🔄 إخفاء التحميل
                }
            });
        }

        // ✅ دالة تسجيل المستخدم الجديد
        if (registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('reg_password').value.trim();

                if (!email || !password) {
                    showAlert("❌ Please enter a valid email and password.", "error");
                    return;
                }

                loader.style.display = "block"; // 🔄 إظهار التحميل

                try {
                    const res = await fetch(`${API_URL}/register`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ email, password })
                    });

                    if (!res.ok) {
                        const data = await res.json();
                        throw new Error(data.message || "❌ Registration failed");
                    }

                    showAlert("✅ Registration successful! Please login.", "success");
                    setTimeout(() => window.location.href = "login.html", 1000);
                } catch (error) {
                    showAlert(`❌ Registration failed: ${error.message}`, "error");
                    console.error("🚨 Registration error:", error);
                } finally {
                    loader.style.display = "none"; // 🔄 إخفاء التحميل
                }
            });
        }

        // ✅ التحقق من تسجيل الدخول
        checkLoginStatus();
    });

    // ✅ دالة لحفظ بيانات المستخدم بناءً على "Remember Me"
    function saveUserSession(token, rememberMe) {
        if (rememberMe) {
            localStorage.setItem("token", token);
        } else {
            sessionStorage.setItem("token", token);
        }
    }

    // ✅ دالة التحقق من تسجيل الدخول
    function checkLoginStatus() {
        const token = localStorage.getItem("token") || sessionStorage.getItem("token");
        const currentPage = window.location.pathname.split("/").pop();

        if (!token && currentPage !== "login.html") {
            window.location.href = "login.html";
        }
    }

    // ✅ دالة تسجيل الخروج
    function logout() {
        localStorage.removeItem("token");
        sessionStorage.removeItem("token");
        showAlert("✅ Logged out successfully!", "success");
        setTimeout(() => window.location.href = "login.html", 1000);
    }

    // ✅ دالة عرض إشعارات الرسائل
    function showAlert(message, type) {
        const alertBox = document.createElement("div");
        alertBox.innerText = message;
        alertBox.className = `alert ${type}`;
        document.body.appendChild(alertBox);

        setTimeout(() => alertBox.remove(), 3000);
    }

</script>
<!-- Plugins JS -->
<script src="plugins.js"></script>

<!-- Main JS -->



</body>

</html>